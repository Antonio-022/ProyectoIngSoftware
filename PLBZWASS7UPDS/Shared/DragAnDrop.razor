@using Microsoft.AspNetCore.Components.Forms;
@inject IMensajeToastr message
<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;" class="contentShared">
    <div class="container-inputShared @dashed  " style="height:270px ; width:270px;">
        <InputFile @ref="@SharedInput" accept="@_AcceptFile" draggable="true" id="inputShared" OnChange="getFile" />
        <div class="title-inputshared  ">
            <img src="@imgSrc" style="width:inherit; height:inherit;" />
        </div>

    </div>
    <div>
        <h6 class="mt-3">
            Arrastre y suelte la Imagen Aquí
        </h6>
    </div>
    
</div>

@code {
    private string imgSrc = "https://media.istockphoto.com/vectors/default-profile-picture-avatar-photo-placeholder-vector-illustration-vector-id1223671392?k=20&m=1223671392&s=612x612&w=0&h=lGpj2vWAI3WUT1JeJWm1PRoHT3V15_1pdcTn2szdwQ0=";
    private bool stateDisplay = true;
    private string? Display => stateDisplay ? "d-flex" : "d-none";
    private string? dashed => stateDisplay ? "dashed" : null;
    private string? DisplayPreview => stateDisplay ? "d-none" : "d-flex";
    const string format = "image/jpeg";
    [Parameter] public int MaxSize { get; set; }
    InputFile? SharedInput;
    [Parameter]public Accept AcceptFile {get; set;}
    private string _AcceptFile
    {
        get
        {

            switch (AcceptFile)
            {
                case Accept.imagen:
                    return "image/*";
                case Accept.audio:
                    return "audio/*";
                case Accept.video:
                    return "video/*l";
                case Accept.documento:
                    return ".doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,.pdf";
                case Accept.all:
                    return "";
                default:
                    return "";
            }
        }

    }

    private async Task getFile(InputFileChangeEventArgs e)
    {
        
        var a = e.File.ContentType;
        //var b = a.Split('/')[0];
        var KB = MaxSize * 1000;
        var B = KB * 1000;

        if(e.File.Size <= B)
        {
            var stream = e.File.OpenReadStream(maxAllowedSize: e.File.Size);
            var ms = new MemoryStream();
            await stream.CopyToAsync(ms);
            var buffer = ms.ToArray();
            var imgb64 = Convert.ToBase64String(buffer);
            imgSrc = $"data:{format};base64,{imgb64}";
            stateDisplay = false;
            this.StateHasChanged();
        }
        else
        {
          await message.MostrarMensajeError("el archivo no debe superar los "+ MaxSize+" MB");
        }

    }
}